openapi: 3.0.3
info:
  title: Mars Vista API
  version: 1.0.0
  description: |
    NASA Mars rover photo API.

    ## Endpoints

    - `/api/v1/rovers` - List all rovers
    - `/api/v1/rovers/{name}` - Get specific rover
    - `/api/v1/rovers/{name}/photos` - Query photos by sol, date, or camera
    - `/api/v1/rovers/{name}/latest` - Get latest photos
    - `/api/v1/photos/{id}` - Get photo by ID
    - `/api/v1/manifests/{name}` - Get rover manifest
    - `/health` - Health check

servers:
  - url: https://api.marsvista.dev
    description: Production server
  - url: http://localhost:5127
    description: Local development server

tags:
  - name: Rovers
    description: Query rover information
  - name: Photos
    description: Query Mars rover photos
  - name: Manifests
    description: Get photo availability manifests
  - name: Health
    description: Service health checks

paths:
  /api/v1/rovers:
    get:
      tags:
        - Rovers
      summary: Get all rovers
      description: Returns a list of all Mars rovers with their details, including cameras, mission status, and photo counts.
      operationId: getAllRovers
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  rovers:
                    type: array
                    items:
                      $ref: '#/components/schemas/Rover'
              examples:
                success:
                  summary: All rovers
                  value:
                    rovers:
                      - id: 2
                        name: "Curiosity"
                        landingDate: "2012-08-06"
                        launchDate: "2011-11-26"
                        status: "active"
                        maxSol: 4683
                        maxDate: "2025-11-14"
                        totalPhotos: 675432
                        cameras:
                          - id: 20
                            name: "MAST"
                            fullName: "Mast Camera"
                          - id: 21
                            name: "NAVCAM"
                            fullName: "Navigation Camera"
        '429':
          $ref: '#/components/responses/RateLimitExceeded'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/rovers/{name}:
    get:
      tags:
        - Rovers
      summary: Get specific rover
      description: Returns detailed information about a specific Mars rover.
      operationId: getRoverByName
      parameters:
        - $ref: '#/components/parameters/RoverName'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  rover:
                    $ref: '#/components/schemas/Rover'
              examples:
                curiosity:
                  summary: Curiosity rover
                  value:
                    rover:
                      id: 2
                      name: "Curiosity"
                      landingDate: "2012-08-06"
                      launchDate: "2011-11-26"
                      status: "active"
                      maxSol: 4683
                      maxDate: "2025-11-14"
                      totalPhotos: 675432
                      cameras:
                        - id: 20
                          name: "MAST"
                          fullName: "Mast Camera"
        '404':
          description: Rover not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: "Rover 'invalid' not found"
        '429':
          $ref: '#/components/responses/RateLimitExceeded'

  /api/v1/rovers/{name}/photos:
    get:
      tags:
        - Photos
      summary: Query photos for a rover
      description: |
        Query photos taken by a specific Mars rover.

        Requires at least one of: `sol` or `earth_date` parameter.
      operationId: queryPhotos
      parameters:
        - $ref: '#/components/parameters/RoverName'
        - name: sol
          in: query
          description: Martian sol (mission day) to query
          schema:
            type: integer
            minimum: 0
          example: 1000
        - name: earth_date
          in: query
          description: Earth date in YYYY-MM-DD format
          schema:
            type: string
            format: date
          example: "2021-04-19"
        - name: camera
          in: query
          description: Camera name filter (e.g., NAVCAM, MAST, FHAZ, RHAZ)
          schema:
            type: string
          example: "NAVCAM"
        - name: page
          in: query
          description: Page number for pagination
          schema:
            type: integer
            minimum: 1
            default: 1
          example: 1
        - name: per_page
          in: query
          description: Results per page (max 100)
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 25
          example: 25
        - name: format
          in: query
          description: Response format (snake_case or camelCase)
          schema:
            type: string
            enum: [snake_case, camelCase]
            default: snake_case
          example: snake_case
      responses:
        '200':
          description: Successful response with photos
          content:
            application/json:
              schema:
                type: object
                properties:
                  photos:
                    type: array
                    items:
                      $ref: '#/components/schemas/Photo'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
              examples:
                navcam_photos:
                  summary: Navigation camera photos from sol 1000
                  value:
                    photos:
                      - id: 123456
                        sol: 1000
                        camera:
                          id: 21
                          name: "NAVCAM"
                          fullName: "Navigation Camera"
                          roverId: 2
                        imgSrc: "https://mars.jpl.nasa.gov/msl-raw-images/proj/msl/redops/ods/surface/sol/01000/opgs/edr/ncam/NLB_450123456EDR_F0482342NCAM00237M_.JPG"
                        earthDate: "2021-04-19"
                        rover:
                          id: 2
                          name: "Curiosity"
                          landingDate: "2012-08-06"
                          launchDate: "2011-11-26"
                          status: "active"
                    pagination:
                      total_count: 45
                      page: 1
                      per_page: 25
                      total_pages: 2
        '400':
          description: Bad request (invalid parameters)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missing_filter:
                  summary: Missing required filter
                  value:
                    error: "Either 'sol' or 'earth_date' parameter is required"
                invalid_date:
                  summary: Invalid date format
                  value:
                    error: "Invalid earth_date format. Use YYYY-MM-DD."
        '404':
          description: Rover not found or no photos match criteria
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: "No photos found for the given criteria"
        '429':
          $ref: '#/components/responses/RateLimitExceeded'

  /api/v1/rovers/{name}/latest:
    get:
      tags:
        - Photos
      summary: Get latest photos from rover
      description: Get the most recent photos from a rover (highest sol number).
      operationId: getLatestPhotos
      parameters:
        - $ref: '#/components/parameters/RoverName'
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: per_page
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 25
      responses:
        '200':
          description: Latest photos
          content:
            application/json:
              schema:
                type: object
                properties:
                  photos:
                    type: array
                    items:
                      $ref: '#/components/schemas/Photo'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'

  /api/v1/photos/{id}:
    get:
      tags:
        - Photos
      summary: Get photo by ID
      description: Retrieve a specific photo by its unique identifier.
      operationId: getPhotoById
      parameters:
        - name: id
          in: path
          required: true
          description: Photo ID
          schema:
            type: integer
          example: 451603
      responses:
        '200':
          description: Photo found
          content:
            application/json:
              schema:
                type: object
                properties:
                  photo:
                    $ref: '#/components/schemas/Photo'
        '404':
          description: Photo not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: "Photo not found"
        '429':
          $ref: '#/components/responses/RateLimitExceeded'

  /api/v1/manifests/{name}:
    get:
      tags:
        - Manifests
      summary: Get rover manifest
      description: Get a summary of available photos organized by sol, including photo counts and available cameras for each sol.
      operationId: getRoverManifest
      parameters:
        - $ref: '#/components/parameters/RoverName'
      responses:
        '200':
          description: Rover manifest
          content:
            application/json:
              schema:
                type: object
                properties:
                  manifest:
                    $ref: '#/components/schemas/Manifest'
              examples:
                curiosity_manifest:
                  summary: Curiosity manifest
                  value:
                    manifest:
                      name: "Curiosity"
                      landingDate: "2012-08-06"
                      launchDate: "2011-11-26"
                      status: "active"
                      maxSol: 4683
                      maxDate: "2025-11-14"
                      totalPhotos: 675432
                      photos:
                        - sol: 1
                          earthDate: "2012-08-06"
                          totalPhotos: 20
                          cameras: ["MAST", "MAHLI", "MARDI", "NAVCAM"]
                        - sol: 2
                          earthDate: "2012-08-07"
                          totalPhotos: 148
                          cameras: ["MAST", "NAVCAM", "FHAZ", "RHAZ"]
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'

  /health:
    get:
      tags:
        - Health
      summary: Health check
      description: Check API and database health status.
      operationId: healthCheck
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [Healthy, Degraded, Unhealthy]
                  timestamp:
                    type: string
                    format: date-time
                  duration:
                    type: number
                    description: Health check duration in milliseconds
                  checks:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                        status:
                          type: string
                        duration:
                          type: number
                        description:
                          type: string
                        error:
                          type: string
              example:
                status: "Healthy"
                timestamp: "2025-11-16T00:00:00.000Z"
                duration: 45.2
                checks:
                  - name: "database"
                    status: "Healthy"
                    duration: 42.1
                    description: null
                    error: null
                  - name: "postgresql"
                    status: "Healthy"
                    duration: 43.5
                    description: null
                    error: null
        '503':
          description: Service is unhealthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  timestamp:
                    type: string
                    format: date-time
                  checks:
                    type: array
                    items:
                      type: object

components:
  parameters:
    RoverName:
      name: name
      in: path
      required: true
      description: Rover name (curiosity, perseverance, opportunity, spirit)
      schema:
        type: string
        enum: [curiosity, perseverance, opportunity, spirit]
      example: curiosity

  schemas:
    Rover:
      type: object
      properties:
        id:
          type: integer
          description: Unique rover identifier
        name:
          type: string
          description: Rover name
        landingDate:
          type: string
          format: date
          description: Mission landing date on Mars
        launchDate:
          type: string
          format: date
          description: Mission launch date from Earth
        status:
          type: string
          enum: [active, complete]
          description: Mission status
        maxSol:
          type: integer
          description: Highest sol number with photos
        maxDate:
          type: string
          format: date
          description: Most recent Earth date with photos
        totalPhotos:
          type: integer
          description: Total number of photos in database
        cameras:
          type: array
          items:
            $ref: '#/components/schemas/Camera'

    Camera:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
          description: Camera abbreviation (e.g., NAVCAM, MAST)
        fullName:
          type: string
          description: Full camera name
        roverId:
          type: integer
          description: Associated rover ID

    Photo:
      type: object
      properties:
        id:
          type: integer
          description: Unique photo identifier
        sol:
          type: integer
          description: Martian sol (mission day)
        camera:
          $ref: '#/components/schemas/Camera'
        imgSrc:
          type: string
          format: uri
          description: URL to the photo image
        earthDate:
          type: string
          format: date
          description: Earth date when photo was taken
        rover:
          $ref: '#/components/schemas/Rover'

    Manifest:
      type: object
      properties:
        name:
          type: string
        landingDate:
          type: string
          format: date
        launchDate:
          type: string
          format: date
        status:
          type: string
        maxSol:
          type: integer
        maxDate:
          type: string
          format: date
        totalPhotos:
          type: integer
        photos:
          type: array
          items:
            type: object
            properties:
              sol:
                type: integer
              earthDate:
                type: string
                format: date
              totalPhotos:
                type: integer
              cameras:
                type: array
                items:
                  type: string

    Pagination:
      type: object
      properties:
        total_count:
          type: integer
          description: Total number of results
        page:
          type: integer
          description: Current page number
        per_page:
          type: integer
          description: Results per page
        total_pages:
          type: integer
          description: Total number of pages

    Error:
      type: object
      properties:
        error:
          type: string
          description: Error message
        details:
          type: string
          description: Optional additional context

  responses:
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: "Resource not found"

    RateLimitExceeded:
      description: Rate limit exceeded
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
              message:
                type: string
              retryAfter:
                type: number
                description: Seconds until rate limit resets
          example:
            error: "Too Many Requests"
            message: "Rate limit exceeded. Maximum 100 requests per minute per IP address."
            retryAfter: 60

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: "An unexpected error occurred"

